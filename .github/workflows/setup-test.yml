name: Bootstrap setup
on: [push]
jobs:
  test-macos:
    runs-on: macos-latest
    permissions:
      contents: read
    env:
      CI: true
      HOMEBREW_NO_AUTO_UPDATE: 1
      HOMEBREW_NO_INSTALL_CLEANUP: 1
    steps:
      - uses: actions/checkout@v5
      - shell: bash
        run: |
          ./bootstrap.sh

  test-linux:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    env:
      CI: true
    container:
      image: rockylinux:9
    steps:
      - name: Install git and basic tools
        run: |
          dnf install -y git sudo
      - uses: actions/checkout@v5
      - name: Test chezmoi initialization
        run: |
          # Install chezmoi
          curl --fail --location --silent https://git.io/chezmoi | BINDIR="$HOME/bin" sh
          export PATH="$HOME/bin:$PATH"

          # Initialize chezmoi (without --apply to avoid interactive prompts)
          chezmoi init --source="$GITHUB_WORKSPACE"

          # Validate templates render correctly by running diff (discards output)
          # This processes all templates including loading .chezmoidata files
          chezmoi diff > /dev/null
          echo "âœ“ All templates validated successfully"
