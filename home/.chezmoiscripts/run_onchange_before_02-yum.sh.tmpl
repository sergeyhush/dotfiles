{{- if eq .chezmoi.os "linux" -}}
{{- if or (eq .chezmoi.osRelease.id "rocky") (eq .chezmoi.osRelease.id "rhel") (hasPrefix "rhel" .chezmoi.osRelease.idLike) -}}
#!/usr/bin/env bash
echo "> Install yum/dnf packages"

set -eo pipefail

# Determine package manager (dnf is preferred on modern RHEL-based systems)
if command -v dnf &> /dev/null; then
    PKG_MGR="dnf"
else
    PKG_MGR="yum"
fi

echo "> Using $PKG_MGR as package manager"

# Enable EPEL repository if not already enabled (required for many packages)
if ! rpm -q epel-release &> /dev/null; then
    echo "> Installing EPEL repository"
    sudo $PKG_MGR install -y epel-release
fi

# Add mise repository
if ! test -f /etc/yum.repos.d/mise.repo; then
    echo "> Adding mise repository"
    sudo tee /etc/yum.repos.d/mise.repo > /dev/null <<EOF
[mise]
name=mise
baseurl=https://mise.jdx.dev/rpm
enabled=1
gpgcheck=1
gpgkey=https://mise.jdx.dev/gpg-key.pub
EOF
fi


# Install packages from the list
echo "> Installing packages..."
{{ range .packages.yum.common.packages }}
sudo $PKG_MGR install -y {{ . | quote }}
{{ end }}

echo "> Package installation complete"

# Note: Some tools like atuin, starship, and uv need to be installed separately
# See comments in packages.toml for installation URLs

{{- end }}
{{- end }}
